{"componentChunkName":"component---src-pages-prereq-kubernetes-minikube-mdx","path":"/prereq/kubernetes/minikube/","result":{"pageContext":{"frontmatter":{"title":"Minikube","description":"Minikube","tabs":["Kubernetes Overview","Minikube","IBM Cloud Kubernetes Service"]},"relativePagePath":"/prereq/kubernetes/minikube.mdx","titleType":"page","MdxNode":{"id":"1e99296c-28f6-5731-b70f-73b85d05a13c","children":[],"parent":"d3cda597-5ee3-5506-8f42-531a24939773","internal":{"content":"---\ntitle: Minikube\ndescription: Minikube\ntabs: ['Kubernetes Overview','Minikube','IBM Cloud Kubernetes Service']\n---\n\nMinikube runs a single-node Kubernetes cluster inside a virtual machine (VM) on your laptop, for users who want to try out Kubernetes or develop with it.\nMinikube documentation is available at [Installing Kubernetes with Minikube](https://minikube.sigs.k8s.io/docs/start/).\nThe following sections are not a substitute for the official documentation but they get you started in a classic configuration.\n\nThe following installation steps are described:\n\n* Installing Minikube\n* Setting up the Docker® registry\n* Configuring the hosts file for Minikube\n* Starting Minikube\n* Enabling Helm for Minikube\n* A summary of some useful Minikube commands\n\n## Minikube installation\n\nMinikube installation steps are described in the official documentation for your preferred Operating System: [Install Minikube](https://minikube.sigs.k8s.io/docs/start/).\n\n## Starting Minikube\n\n<InlineNotification kind=\"info\">\n\n**Note:** In the following example we set the `--insecure-registry` option passing in a subnet of `192.168.0.0/16`.\nThe IP address on your machine _may_ not be on the appropriate network for this subnet to work.\nTherefore, start a Minikube instance to verify the IP address begins with 192.168.0.X. You need only do this once.\nSee the note in [Specifying the insecure registry](#specifying-the-insecure-registry).\n\n</InlineNotification>\n\nMinikube can be started with a command as simple as `minikube start` without any additional parameters. However, the resulting VM will be too small to deploy an instance of IBM® Cúram Social Program Management (SPM),\nso several other parameters are required:\n\n```shell\nminikube start --driver=virtualbox --cpus 4 --memory 8G \\\n               --insecure-registry \"192.168.0.0/16\" \\\n               --disk-size='30G' \\\n               --kubernetes-version v1.18.16\n```\n\n### Specifying the resource allocation\n\nYou can add properties to specify the resource allocation. For example:\n\n* `--cpus 4` to use 4 CPUs\n* `--memory 8G` to use 8 GB of RAM\n* `--disk-size=30G` to use 30 GB of disk space\n\n### Specifying the VM driver\n\nAdd the `--driver=` option to the `minikube start` command to specify the underlying virtual machine driver. The following drivers were tested:\n\n* `--driver=virtualbox` - [VirtualBox](https://minikube.sigs.k8s.io/docs/drivers/virtualbox/) on OSX, Linux, and Windows\n* `--driver=vmware` - [VMware Fusion](https://minikube.sigs.k8s.io/docs/drivers/vmware/) on OSX\n  * **Note**: There is an [issue](https://github.com/kubernetes/minikube/issues/9720) running Minikube on macOS Big Sur with VMware Fusion 12. If you are using Big Sur, use an alternative driver.\n* `--driver=docker` - [Docker](https://minikube.sigs.k8s.io/docs/drivers/kvm2/) on Linux\n* `--driver=kvm2` - [KVM](https://minikube.sigs.k8s.io/docs/drivers/kvm2/) on Linux\n\nThe [Install Minikube](https://minikube.sigs.k8s.io/docs/start/) page gives you more information on available VM driver options.\n\n### Specifying the insecure registry\n\nYou must specify the `--insecure-registry` option to reference the Docker registry that is created. The `--insecure-registry` value is the same as specified in the  `daemon.json` file.\n\n<InlineNotification>\n\n**Note:** Because of a limitation in the current version of Minikube, adding the `--insecure-registry` option works on a new Minikube instance only.\nIf you start Minikube, be sure to run `minikube stop` and `minikube delete` before you start it again with the `--insecure-registry` option.\n\n</InlineNotification>\n\n### Specifying the Kubernetes version\n\nYou can override the version of Kubernetes that gets installed inside the Minikube VM by using the `--kubernetes-version` flag. This flag controls the compatibility between the client tools and the Kubernetes specification.\n\nIf you override the Kubernetes version, ensure that you download and install the corresponding version of `kubectl` - this version must be the same version as the Kubernetes cluster.\n\n<InlineNotification>\n\n**Note:** The `kubectl` version running locally and on Minikube should be compatible, so it's possible to use the `--kubernetes-version` flag to keep them consistent.\n\n</InlineNotification>\n\n## Docker Hub download rate limit and Minikube\n\nIn November 2020, Docker introduced [download rate limits](https://docs.docker.com/docker-hub/download-rate-limit/) on Docker Hub.\nNormally, this can be mitigated by providing an Image Pull Secret to the deployment.\n\nFor Minikube addons these pull secrets are not exposed, so the solution involves providing a `config.json` file containing the credentials to the Kubelet process running inside the Minikube environment.\n\n1. Authenticate your local Docker client with Docker Hub: `docker login`\n    * You can register for a free account on the [Docker Hub website](https://hub.docker.com/signup)\n2. Copy the contents of your local Docker secrets:\n\n    ```shell\n    cat ~/.docker/config.json && echo\n    ```\n\n    * The output should look something like below:\n\n    ```json\n    {\n      \"auths\": {\n        \"https://index.docker.io/v1/\": {\n          \"auth\": \"<base64 of username:password>\"\n        }\n      }\n    }\n    ```\n\n3. Open a terminal in your Minikube VM:\n\n    ```shell\n    minikube ssh\n    ```\n\n4. Paste the contents of the file from step 2 into `/var/lib/kubelet/config.json`:\n\n    * Edit the command to include the contents of your `config.json` file first\n\n    ```shell\n    cat << EOS | sudo tee /var/lib/kubelet/config.json\n    {\n      \"auths\": {\n        \"https://index.docker.io/v1/\": {\n          \"auth\": \"<base64 of username:password>\"\n        }\n      }\n    }\n    EOS\n    ```\n\n5. Restart the `kubelet` process in the Minikube VM:\n\n    ```shell\n    sudo systemctl restart kubelet\n    ```\n\n6. Exit the Minikube terminal.\n\n## Docker registry\n\nYou need a registry to use docker images with Helm in Minikube.\nThere are different types of registries that can be used. However, this page describes a simple registry option that doesn't require extra components.\n\nMinikube provides an add-on to run a registry in a container. For more information, see [How to access the Docker registry within minikube](https://minikube.sigs.k8s.io/docs/tasks/docker_registry/).\n\nYou can use the following command to enable the add-on:\n\n```shell\nminikube addons enable registry\n```\n\nWhen enabled, starting Minikube starts two pods on the `kube-system` namespace, named `registry` and `registry-proxy`. Now the registry is active and can be used. The registry points to the Minikube IP address on port 5000.\n\nThe containers don't mount any volumes, so stopping Minikube deletes the registry content.\n\n## Hostname configuration for Minikube\n\nThis runbook uses a generic hostname of `minikube.local` as an example in commands and the configuration files.\nYou should add the Minikube IP address to the `hosts` file by using the generic hostname, or else modify the usage of `minikube.local` in this runbook to reflect your local hostname.\n\nSpecifying `minikube ip` in the following command returns the Minikube VM's IP address that is accessible from your workstation:\n\n<Tabs>\n\n<Tab label=\"Mac/Linux\">\n<Row>\n<Column>\n\n```shell\necho -e \"$(minikube ip)\\tminikube.local\" | sudo tee -a /etc/hosts\n```\n\n</Column>\n</Row>\n</Tab>\n\n<Tab label=\"Windows\">\n<Row>\n<Column>\n\n```powershell\nAdd-Content -Path C:\\Windows\\System32\\drivers\\etc\\hosts -Value \"$(minikube ip)`tminikube.local\" -Force\n```\n\n</Column>\n</Row>\n</Tab>\n\n</Tabs>\n\nThe local Docker client configuration must be also be updated with the corresponding IP address.\n\n* Update the `daemon.json` docker configuration file with the Minikube IP address. This file is usually located in:\n  * `~/.docker/daemon.json` on OSX\n  * `/etc/docker/daemon.json` on Linux\n  * `C:\\ProgramData\\Docker\\config\\daemon.json` on Windows\n* Restart the Docker daemon:\n  * On Linux - run: `sudo systemctl restart docker`\n  * On Mac and Windows - use the \"Restart Docker\" menu option in the Docker Desktop application.\n\nExample of `daemon.json`:\n\n```json\n{\n  \"insecure-registries\": [\n    \"192.168.0.0/16\"\n  ]\n}\n```\n\n<InlineNotification>\n\n**Note:** You can provide a specific IP address, or specify a subnet to future-proof the Docker client configuration.\n\n</InlineNotification>\n\nThe Minikube IP address might change when you run `minikube delete`. If it changes, you must repeat these steps.\n\nTherefore, reconfirm the Minikube IP and its setting in the `hosts` file every time you start Minikube, or after you run `minikube delete`.\n\n## Minikube Ingress\n\nIngress is a reverse proxy, which sits in front of the application that is deployed in Kubernetes. It facilitates use of a custom domain name to access a deployed application, instead of using service ports.\nTo enable Ingress for Minikube, you must enable the `ingress` add-on.\n\n```shell\nminikube addons enable ingress\n```\n\n## Create a namespace\n\nCreate a namespace for the SPM deployment, again use an environment variable for your convenience when following the guide.\n\nCreate the environment variable, you can set to value to anything you like, but it should consist of lower case alphanumeric characters or `-`, and must start and end with an alphanumeric character (e.g. `my-name`,  or `123-abc`):\n\n```shell\nexport PROJECT=\"dev\"\n```\n\nCreate the namespace:\n\n```shell\nkubectl create namespace $PROJECT\n```\n\nSwitch to the new namespace:\n\n```shell\nkubectl config set-context --current --namespace $PROJECT\n```\n\n## Useful Minikube commands\n\nSome useful Minikube commands are as follows:\n\n```shell\n# Sample commands\nminikube status       # See if Minikube is running\nminikube start        # Create and start Minikube\nminikube dashboard    # Access the Kubernetes dashboard running within the Minikube cluster\nminikube ssh          # Login into the Minikube VM\nminikube addons list  # Show the status of the available add-ons\nminikube stop         # Stop Minikube\nminikube delete       # Delete the Minikube VM\nminikube ip           # Show the Minikube IP\n```\n\nFor a full list of commands, see [Installing Kubernetes with Minikube](https://minikube.sigs.k8s.io/docs/start/).\n","type":"Mdx","contentDigest":"e8c6957a802b32fa5980d06671ad27e5","owner":"gatsby-plugin-mdx","counter":202},"frontmatter":{"title":"Minikube","description":"Minikube","tabs":["Kubernetes Overview","Minikube","IBM Cloud Kubernetes Service"]},"exports":{},"rawBody":"---\ntitle: Minikube\ndescription: Minikube\ntabs: ['Kubernetes Overview','Minikube','IBM Cloud Kubernetes Service']\n---\n\nMinikube runs a single-node Kubernetes cluster inside a virtual machine (VM) on your laptop, for users who want to try out Kubernetes or develop with it.\nMinikube documentation is available at [Installing Kubernetes with Minikube](https://minikube.sigs.k8s.io/docs/start/).\nThe following sections are not a substitute for the official documentation but they get you started in a classic configuration.\n\nThe following installation steps are described:\n\n* Installing Minikube\n* Setting up the Docker® registry\n* Configuring the hosts file for Minikube\n* Starting Minikube\n* Enabling Helm for Minikube\n* A summary of some useful Minikube commands\n\n## Minikube installation\n\nMinikube installation steps are described in the official documentation for your preferred Operating System: [Install Minikube](https://minikube.sigs.k8s.io/docs/start/).\n\n## Starting Minikube\n\n<InlineNotification kind=\"info\">\n\n**Note:** In the following example we set the `--insecure-registry` option passing in a subnet of `192.168.0.0/16`.\nThe IP address on your machine _may_ not be on the appropriate network for this subnet to work.\nTherefore, start a Minikube instance to verify the IP address begins with 192.168.0.X. You need only do this once.\nSee the note in [Specifying the insecure registry](#specifying-the-insecure-registry).\n\n</InlineNotification>\n\nMinikube can be started with a command as simple as `minikube start` without any additional parameters. However, the resulting VM will be too small to deploy an instance of IBM® Cúram Social Program Management (SPM),\nso several other parameters are required:\n\n```shell\nminikube start --driver=virtualbox --cpus 4 --memory 8G \\\n               --insecure-registry \"192.168.0.0/16\" \\\n               --disk-size='30G' \\\n               --kubernetes-version v1.18.16\n```\n\n### Specifying the resource allocation\n\nYou can add properties to specify the resource allocation. For example:\n\n* `--cpus 4` to use 4 CPUs\n* `--memory 8G` to use 8 GB of RAM\n* `--disk-size=30G` to use 30 GB of disk space\n\n### Specifying the VM driver\n\nAdd the `--driver=` option to the `minikube start` command to specify the underlying virtual machine driver. The following drivers were tested:\n\n* `--driver=virtualbox` - [VirtualBox](https://minikube.sigs.k8s.io/docs/drivers/virtualbox/) on OSX, Linux, and Windows\n* `--driver=vmware` - [VMware Fusion](https://minikube.sigs.k8s.io/docs/drivers/vmware/) on OSX\n  * **Note**: There is an [issue](https://github.com/kubernetes/minikube/issues/9720) running Minikube on macOS Big Sur with VMware Fusion 12. If you are using Big Sur, use an alternative driver.\n* `--driver=docker` - [Docker](https://minikube.sigs.k8s.io/docs/drivers/kvm2/) on Linux\n* `--driver=kvm2` - [KVM](https://minikube.sigs.k8s.io/docs/drivers/kvm2/) on Linux\n\nThe [Install Minikube](https://minikube.sigs.k8s.io/docs/start/) page gives you more information on available VM driver options.\n\n### Specifying the insecure registry\n\nYou must specify the `--insecure-registry` option to reference the Docker registry that is created. The `--insecure-registry` value is the same as specified in the  `daemon.json` file.\n\n<InlineNotification>\n\n**Note:** Because of a limitation in the current version of Minikube, adding the `--insecure-registry` option works on a new Minikube instance only.\nIf you start Minikube, be sure to run `minikube stop` and `minikube delete` before you start it again with the `--insecure-registry` option.\n\n</InlineNotification>\n\n### Specifying the Kubernetes version\n\nYou can override the version of Kubernetes that gets installed inside the Minikube VM by using the `--kubernetes-version` flag. This flag controls the compatibility between the client tools and the Kubernetes specification.\n\nIf you override the Kubernetes version, ensure that you download and install the corresponding version of `kubectl` - this version must be the same version as the Kubernetes cluster.\n\n<InlineNotification>\n\n**Note:** The `kubectl` version running locally and on Minikube should be compatible, so it's possible to use the `--kubernetes-version` flag to keep them consistent.\n\n</InlineNotification>\n\n## Docker Hub download rate limit and Minikube\n\nIn November 2020, Docker introduced [download rate limits](https://docs.docker.com/docker-hub/download-rate-limit/) on Docker Hub.\nNormally, this can be mitigated by providing an Image Pull Secret to the deployment.\n\nFor Minikube addons these pull secrets are not exposed, so the solution involves providing a `config.json` file containing the credentials to the Kubelet process running inside the Minikube environment.\n\n1. Authenticate your local Docker client with Docker Hub: `docker login`\n    * You can register for a free account on the [Docker Hub website](https://hub.docker.com/signup)\n2. Copy the contents of your local Docker secrets:\n\n    ```shell\n    cat ~/.docker/config.json && echo\n    ```\n\n    * The output should look something like below:\n\n    ```json\n    {\n      \"auths\": {\n        \"https://index.docker.io/v1/\": {\n          \"auth\": \"<base64 of username:password>\"\n        }\n      }\n    }\n    ```\n\n3. Open a terminal in your Minikube VM:\n\n    ```shell\n    minikube ssh\n    ```\n\n4. Paste the contents of the file from step 2 into `/var/lib/kubelet/config.json`:\n\n    * Edit the command to include the contents of your `config.json` file first\n\n    ```shell\n    cat << EOS | sudo tee /var/lib/kubelet/config.json\n    {\n      \"auths\": {\n        \"https://index.docker.io/v1/\": {\n          \"auth\": \"<base64 of username:password>\"\n        }\n      }\n    }\n    EOS\n    ```\n\n5. Restart the `kubelet` process in the Minikube VM:\n\n    ```shell\n    sudo systemctl restart kubelet\n    ```\n\n6. Exit the Minikube terminal.\n\n## Docker registry\n\nYou need a registry to use docker images with Helm in Minikube.\nThere are different types of registries that can be used. However, this page describes a simple registry option that doesn't require extra components.\n\nMinikube provides an add-on to run a registry in a container. For more information, see [How to access the Docker registry within minikube](https://minikube.sigs.k8s.io/docs/tasks/docker_registry/).\n\nYou can use the following command to enable the add-on:\n\n```shell\nminikube addons enable registry\n```\n\nWhen enabled, starting Minikube starts two pods on the `kube-system` namespace, named `registry` and `registry-proxy`. Now the registry is active and can be used. The registry points to the Minikube IP address on port 5000.\n\nThe containers don't mount any volumes, so stopping Minikube deletes the registry content.\n\n## Hostname configuration for Minikube\n\nThis runbook uses a generic hostname of `minikube.local` as an example in commands and the configuration files.\nYou should add the Minikube IP address to the `hosts` file by using the generic hostname, or else modify the usage of `minikube.local` in this runbook to reflect your local hostname.\n\nSpecifying `minikube ip` in the following command returns the Minikube VM's IP address that is accessible from your workstation:\n\n<Tabs>\n\n<Tab label=\"Mac/Linux\">\n<Row>\n<Column>\n\n```shell\necho -e \"$(minikube ip)\\tminikube.local\" | sudo tee -a /etc/hosts\n```\n\n</Column>\n</Row>\n</Tab>\n\n<Tab label=\"Windows\">\n<Row>\n<Column>\n\n```powershell\nAdd-Content -Path C:\\Windows\\System32\\drivers\\etc\\hosts -Value \"$(minikube ip)`tminikube.local\" -Force\n```\n\n</Column>\n</Row>\n</Tab>\n\n</Tabs>\n\nThe local Docker client configuration must be also be updated with the corresponding IP address.\n\n* Update the `daemon.json` docker configuration file with the Minikube IP address. This file is usually located in:\n  * `~/.docker/daemon.json` on OSX\n  * `/etc/docker/daemon.json` on Linux\n  * `C:\\ProgramData\\Docker\\config\\daemon.json` on Windows\n* Restart the Docker daemon:\n  * On Linux - run: `sudo systemctl restart docker`\n  * On Mac and Windows - use the \"Restart Docker\" menu option in the Docker Desktop application.\n\nExample of `daemon.json`:\n\n```json\n{\n  \"insecure-registries\": [\n    \"192.168.0.0/16\"\n  ]\n}\n```\n\n<InlineNotification>\n\n**Note:** You can provide a specific IP address, or specify a subnet to future-proof the Docker client configuration.\n\n</InlineNotification>\n\nThe Minikube IP address might change when you run `minikube delete`. If it changes, you must repeat these steps.\n\nTherefore, reconfirm the Minikube IP and its setting in the `hosts` file every time you start Minikube, or after you run `minikube delete`.\n\n## Minikube Ingress\n\nIngress is a reverse proxy, which sits in front of the application that is deployed in Kubernetes. It facilitates use of a custom domain name to access a deployed application, instead of using service ports.\nTo enable Ingress for Minikube, you must enable the `ingress` add-on.\n\n```shell\nminikube addons enable ingress\n```\n\n## Create a namespace\n\nCreate a namespace for the SPM deployment, again use an environment variable for your convenience when following the guide.\n\nCreate the environment variable, you can set to value to anything you like, but it should consist of lower case alphanumeric characters or `-`, and must start and end with an alphanumeric character (e.g. `my-name`,  or `123-abc`):\n\n```shell\nexport PROJECT=\"dev\"\n```\n\nCreate the namespace:\n\n```shell\nkubectl create namespace $PROJECT\n```\n\nSwitch to the new namespace:\n\n```shell\nkubectl config set-context --current --namespace $PROJECT\n```\n\n## Useful Minikube commands\n\nSome useful Minikube commands are as follows:\n\n```shell\n# Sample commands\nminikube status       # See if Minikube is running\nminikube start        # Create and start Minikube\nminikube dashboard    # Access the Kubernetes dashboard running within the Minikube cluster\nminikube ssh          # Login into the Minikube VM\nminikube addons list  # Show the status of the available add-ons\nminikube stop         # Stop Minikube\nminikube delete       # Delete the Minikube VM\nminikube ip           # Show the Minikube IP\n```\n\nFor a full list of commands, see [Installing Kubernetes with Minikube](https://minikube.sigs.k8s.io/docs/start/).\n","fileAbsolutePath":"/home/travis/build/IBM/spm-kubernetes/src/pages/prereq/kubernetes/minikube.mdx"}}},"staticQueryHashes":["1054721580","1054721580","1364590287","2102389209","2102389209","2456312558","2746626797","2746626797","3018647132","3018647132","3037994772","3037994772","768070550"]}